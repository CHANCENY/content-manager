{% extends 'default.view.admin_base' %}

{% block body %}
    <h3>{{ "Cron Manage"|t }}</h3>
    <div>
        <a href="/cron/add">+ Create cron</a>
    </div>
    <div>

        <div class="tabs">
            <div class="tab active" onclick="showTab('cron')">{{ "Cron manage"|t }}</div>
            <div class="tab" onclick="showTab('schedules')">{{ "Schedules"|t }}</div>
            <div class="tab" onclick="showTab('logs')">{{ "Logs"|t }}</div>
        </div>

        <div id="cron" class="tab-content active">
            <table>
                <thead>
                <tr>
                    <th>Title</th>
                    <th>Description</th>
                    <th>Action</th>
                </tr>
                </thead>

                <tbody>

                {%  for key, job in jobs  %}

                    <tr>

                        <td>{{ job.title  }}</td>
                        <td>{{ job.description  }}</td>
                        <td>
                            {% if key != 'default_cron' %}
                                <a href="/cron/{{ key }}/edit">Edit</a>
                                <a href="/cron/{{ key }}/delete">Delete</a>
                            {% else %}
                                <a href="/cron/{{ key }}/edit">Reset</a>
                            {% endif %}
                        </td>

                    </tr>

                {% endfor %}

                </tbody>

            </table>
        </div>

        <div id="schedules" class="tab-content">
            <table>
                <thead>
                <tr>
                    <th>Name</th>
                    <th>Last Run</th>
                    <th>Next Run</th>
                    <th>Status</th>
                    <th>Created</th>
                </tr>
                </thead>
                <tbody>
                {% for schedule in schedules %}

                    <tr>
                        <td>{{ schedule.name }}</td>
                        <td>{{ schedule.last_run|date }}<i class="fa-regular fa-clock"></i></td>
                        <td>{{ schedule.next_run|date }}<i class="fa-regular fa-clock"></i></td>
                        <td>{{ schedule.next_run > "now"|date("U") ? 'on schedule' : 'delayed' }}</td>
                        <td>{{ schedule.created_at|date }}</td>
                    </tr>

                {% endfor %}
                </tbody>

            </table>
        </div>

        <div id="logs" class="tab-content">
            <table>
                <thead>
                 <tr>
                     <th>Name</th>
                     <th>Execution time</th>
                     <th>Start Time</th>
                     <th>End Time</th>
                     <th>Status</th>
                     <th>Message</th>
                 </tr>
                </thead>
                <tbody>
                {% for log in logs %}
                    <tr>
                        <td>{{ log.name }}</td>
                        <td>{{ log.execution_time ~ 'secs' }} <i class="fa-regular fa-clock"></i></td>
                        <td>{{ log.start_time|date }} <i class="fa-regular fa-clock"></i></td>
                        <td>{{ log.end_time|date }} <i class="fa-regular fa-clock"></i></td>
                        <td>{{ log.status }}</td>
                        <td>{{ log.message }}</td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>

    </div>
{% endblock %}
